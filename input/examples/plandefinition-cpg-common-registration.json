{
	"resourceType": "PlanDefinition",
	"id": "cpg-common-registration",
	"url": "http://hl7.org/fhir/uv/cpg/PlanDefinition/cpg-common-registration",
	"version": "0.1.0",
	"name": "PlanDefinition_CPG_Common_Registration",
	"title": "PlanDefinition - CPG Common Registration",
	"type": {
		"coding": [
			{
				"system": "http://terminology.hl7.org/CodeSystem/plan-definition-type",
				"code": "workflow-definition",
				"display": "Workflow Definition"
			}
		]
	},
	"status": "draft",
	"date": "2019-05-15",
	"copyright": "Â© WHO 2019+.",
	"action": [
		{
			"title": "Registration",
			"code": [
				{
					"coding": [
						{
							"system": "http://hl7.org/fhir/uv/cpg/CodeSystem/cpg-common-process",
							"code": "registration"
						}
					]
				}
			],
			"participant": [
				{
					"type": "patient",
					"role": {
						"coding": [
							{
								"system": "http://hl7.org/fhir/uv/cpg/CodeSystem/cpg-common-persona",
								"code": "C000"
							}
						]
					}
				},
				{
					"type": "practitioner",
					"role": {
						"coding": [
							{
								"system": "http://hl7.org/fhir/uv/cpg/CodeSystem/cpg-common-persona",
								"code": "W000",
								"display": "Clerical support worker"
							}
						]
					}
				}
			],
			"action": [
				{
					"title": "Gather identifying information",
					"output": [
						{
							"type": "QuestionnaireResponse"
						}
					],
					"participant": [
						{
							"type": "patient",
							"role": {
								"coding": [
									{
										"system": "http://hl7.org/fhir/uv/cpg/CodeSystem/cpg-common-persona",
										"code": "C000"
									}
								]
							}
						}
					],
					"definitionCanonical": "http://hl7.org/fhir/uv/cpg/Questionnaire/cpg-common-identity",
					"fhir_comments": [
						"Gather identifying information"
					]
				},
				{
					"title": "Patient match",
					"input": [
						{
							"type": "QuestionnaireResponse",
							"codeFilter": [
								{
									"path": "questionnaire",
									"code": [
										{
											"system": "urn:ietf:rfc:3986",
											"code": "http://hl7.org/fhir/uv/cpg/Questionnaire/cpg-common-identity"
										}
									]
								}
							]
						}
					],
					"output": [
						{
							"type": "Bundle"
						}
					],
					"participant": [
						{
							"extension": [
								{
									"url": "http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-participantCapabilityStatement",
									"valueCanonical": "http://hl7.org/fhir/uv/cpg/CapabilityStatement/cpg-common-patient-registry"
								}
							],
							"type": "device"
						}
					],
					"definitionUri": "http://hl7.org/fhir/OperationDefinition/Patient-match",
					"fhir_comments": [
						"Patient match"
					]
				},
				{
					"title": "Resolve patient match results",
					"input": [
						{
							"type": "Bundle"
						}
					],
					"output": [
						{
							"type": "Patient"
						}
					],
					"participant": [
						{
							"type": "practitioner",
							"role": {
								"coding": [
									{
										"system": "http://hl7.org/fhir/uv/cpg/CodeSystem/cpg-common-persona",
										"code": "W000",
										"display": "Clerical support worker"
									}
								]
							}
						}
					],
					"definitionCanonical": "http://hl7.org/fhir/uv/cpg/Questionnaire/cpg-common-resolve-patient-match",
					"_definitionCanonical": {
						"fhir_comments": [
							"TODO: Use SDC post processing to establish the output as the specific patient selected"
						]
					},
					"fhir_comments": [
						"Resolve patient match results"
					]
				},
				{
					"title": "New patient",
					"condition": [
						{
							"kind": "applicability",
							"expression": {
								"language": "text/cql",
								"expression": "not exists %input i where i is Patient"
							}
						}
					],
					"input": [
						{
							"type": "Patient"
						}
					],
					"action": [
						{
							"title": "Gather patient information",
							"input": [
								{
									"type": "QuestionnaireResponse",
									"codeFilter": [
										{
											"path": "questionnaire",
											"code": [
												{
													"system": "urn:ietf:rfc:3986",
													"code": "http://hl7.org/fhir/uv/cpg/Questionnaire/cpg-common-identity"
												}
											]
										}
									]
								}
							],
							"output": [
								{
									"type": "QuestionnaireResponse"
								}
							],
							"definitionCanonical": "http://hl7.org/fhir/uv/cpg/Questionnaire/cpg-common-patient-profile",
							"_definitionCanonical": {
								"fhir_comments": [
									"TODO: Use SDC pre processing to auto-populate questionnaire content with the previously entered identity data"
								]
							}
						},
						{
							"title": "Record patient data",
							"input": [
								{
									"type": "QuestionnaireResponse",
									"codeFilter": [
										{
											"path": "questionnaire",
											"code": [
												{
													"system": "urn:ietf:rfc:3986",
													"code": "http://hl7.org/fhir/uv/cpg/Questionnaire/cpg-common-patient-profile"
												}
											]
										}
									]
								}
							],
							"output": [
								{
									"type": "Patient"
								}
							],
							"participant": [
								{
									"extension": [
										{
											"url": "http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-participantCapabilityStatement",
											"valueCanonical": "http://hl7.org/fhir/uv/cpg/CapabilityStatement/cpg-common-patient-registry"
										}
									],
									"type": "device"
								}
							],
							"definitionUri": "http://hl7.org/fhir/restful-interaction#create",
							"_definitionUri": {
								"fhir_comments": [
									"TODO: There is some wizardry here about transforming the questionnaire response into a Patient resource",
									"We can use SDC post processing to do this"
								]
							},
							"fhir_comments": [
								"Record patient data"
							]
						}
					],
					"fhir_comments": [
						"New patient"
					]
				},
				{
					"title": "Existing patient",
					"condition": [
						{
							"kind": "applicability",
							"expression": {
								"language": "text/cql",
								"expression": "exists %input i where i is Patient"
							}
						}
					],
					"input": [
						{
							"type": "Patient"
						}
					],
					"action": [
						{
							"title": "Ensure patient information is up to date",
							"input": [
								{
									"type": "QuestionnaireResponse",
									"codeFilter": [
										{
											"path": "questionnaire",
											"code": [
												{
													"system": "urn:ietf:rfc:3986",
													"code": "http://hl7.org/fhir/uv/cpg/Questionnaire/cpg-common-identity"
												}
											]
										}
									]
								}
							],
							"output": [
								{
									"type": "QuestionnaireResponse"
								}
							],
							"definitionCanonical": "http://hl7.org/fhir/uv/cpg/Questionnaire/cpg-common-patient-profile",
							"_definitionCanonical": {
								"fhir_comments": [
									"TODO: Use SDC pre processing to auto-populate questionnaire content with the previously entered identity data"
								]
							},
							"fhir_comments": [
								"Patient data update"
							]
						},
						{
							"title": "Record patient data",
							"input": [
								{
									"type": "QuestionnaireResponse",
									"codeFilter": [
										{
											"path": "questionnaire",
											"code": [
												{
													"system": "urn:ietf:rfc:3986",
													"code": "http://hl7.org/fhir/uv/cpg/Questionnaire/cpg-common-patient-profile"
												}
											]
										}
									]
								}
							],
							"output": [
								{
									"type": "Patient"
								}
							],
							"participant": [
								{
									"extension": [
										{
											"url": "http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-participantCapabilityStatement",
											"valueCanonical": "http://hl7.org/fhir/uv/cpg/CapabilityStatement/cpg-common-patient-registry"
										}
									],
									"type": "device"
								}
							],
							"definitionUri": "http://hl7.org/fhir/restful-interaction#update",
							"_definitionUri": {
								"fhir_comments": [
									"TODO: There is some wizardry here about transforming the questionnaire response into a Patient resource",
									"We can use SDC post processing to do this"
								]
							},
							"fhir_comments": [
								"Record patient data"
							]
						}
					],
					"fhir_comments": [
						"Existing patient"
					]
				},
				{
					"title": "Patient summary lookup",
					"input": [
						{
							"type": "Patient"
						}
					],
					"output": [
						{
							"type": "Bundle"
						}
					],
					"participant": [
						{
							"extension": [
								{
									"url": "http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-participantCapabilityStatement",
									"valueCanonical": "http://hl7.org/fhir/uv/cpg/CapabilityStatement/cpg-common-patient-registry"
								}
							],
							"type": "device"
						}
					],
					"definitionUri": "http://hl7.org/fhir/uv/cpg/OperationDefinition/cpg-common-patient-summary",
					"fhir_comments": [
						"Patient summary lookup"
					]
				}
			]
		}
	]
}